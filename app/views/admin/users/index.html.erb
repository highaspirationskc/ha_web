<div class="max-w-7xl mx-auto py-6 sm:px-6 lg:px-8">
  <div class="px-4 py-6 sm:px-0">
    <div class="flex justify-between items-center mb-6">
      <h1 class="text-3xl font-bold text-gray-900">Users</h1>
      <%= link_to "New User", new_admin_user_path, class: "inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md shadow-sm text-white bg-indigo-600 hover:bg-indigo-700" %>
    </div>

    <% if notice.present? %>
      <div class="rounded-md bg-green-50 p-4 mb-6">
        <p class="text-sm font-medium text-green-800" id="notice"><%= notice %></p>
      </div>
    <% end %>

    <!-- Filters -->
    <div class="bg-white shadow sm:rounded-lg mb-6">
      <div class="px-4 py-5 sm:p-6">
        <%= form_with url: admin_users_path, method: :get, class: "flex flex-wrap gap-4 items-end" do |f| %>
          <div class="flex-1 min-w-[200px]">
            <%= f.label :search, "Search", class: "block text-sm font-medium text-gray-700" %>
            <%= f.text_field :search, value: params[:search], placeholder: "Email, first name, or last name", class: "mt-1 block w-full py-2 px-3 border border-gray-300 bg-white rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm" %>
          </div>
          <div class="w-48">
            <%= f.label :role, "Role", class: "block text-sm font-medium text-gray-700" %>
            <%= f.select :role, [["All Users", ""], ["Staff", "staff"], ["Mentors", "mentor"], ["Mentees", "mentee"], ["Guardians", "guardian"], ["Volunteers", "volunteer"]], { selected: params[:role] }, { class: "mt-1 block w-full py-2 px-3 border border-gray-300 bg-white rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm" } %>
          </div>
          <div class="flex gap-2">
            <%= f.submit "Filter", class: "inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md shadow-sm text-white bg-indigo-600 hover:bg-indigo-700 cursor-pointer" %>
            <%= link_to "Clear", admin_users_path, class: "inline-flex items-center px-4 py-2 border border-gray-300 text-sm font-medium rounded-md shadow-sm text-gray-700 bg-white hover:bg-gray-50" %>
          </div>
        <% end %>
      </div>
    </div>

    <div class="flex flex-col">
      <div class="-my-2 overflow-x-auto sm:-mx-6 lg:-mx-8">
        <div class="py-2 align-middle inline-block min-w-full sm:px-6 lg:px-8">
          <div class="shadow overflow-hidden border-b border-gray-200 sm:rounded-lg">
            <table class="min-w-full divide-y divide-gray-200">
              <thead class="bg-gray-50">
                <tr>
                  <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                    Name
                  </th>
                  <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                    Role
                  </th>
                  <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                    Status
                  </th>
                  <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                    Created
                  </th>
                  <th scope="col" class="relative px-6 py-3">
                    <span class="sr-only">Actions</span>
                  </th>
                </tr>
              </thead>
              <tbody class="bg-white divide-y divide-gray-200">
                <% @users.each do |user| %>
                  <tr>
                    <td class="px-6 py-4 whitespace-nowrap">
                      <div class="text-sm font-medium text-gray-900"><%= user.first_name %> <%= user.last_name %></div>
                      <div class="text-sm text-gray-500"><%= user.email %></div>
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap">
                      <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-blue-100 text-blue-800">
                        <%= user.role_name %>
                      </span>
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap">
                      <% if user.active? %>
                        <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-green-100 text-green-800">
                          Active
                        </span>
                      <% else %>
                        <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-red-100 text-red-800">
                          Inactive
                        </span>
                      <% end %>
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
                      <%= user.created_at.strftime("%b %d, %Y") %>
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap text-right text-sm font-medium">
                      <%= link_to "View", admin_user_path(user), class: "text-indigo-600 hover:text-indigo-900 mr-4" %>
                      <%= link_to "Edit", edit_admin_user_path(user), class: "text-indigo-600 hover:text-indigo-900 mr-4" %>
                      <% if real_current_user.admin? %>
                        <% if user != real_current_user %>
                          <%= button_to "Spoof", admin_spoof_path(user), method: :post, class: "text-yellow-600 hover:text-yellow-900", form: { class: "inline" } %>
                        <% else %>
                          <span class="text-gray-400 cursor-not-allowed">Spoof</span>
                        <% end %>
                      <% end %>
                    </td>
                  </tr>
                <% end %>
              </tbody>
            </table>
          </div>
        </div>
      </div>
    </div>

    <div class="mt-4">
      <%= paginate @users %>
    </div>
  </div>
</div>

<div class="p-4">
  <% if @media.any? %>
    <div class="grid grid-cols-3 sm:grid-cols-4 gap-3 max-h-96 overflow-y-auto">
      <% @media.each do |medium| %>
        <button type="button"
                class="aspect-square overflow-hidden rounded-lg bg-gray-100 hover:ring-2 hover:ring-indigo-500 focus:outline-none focus:ring-2 focus:ring-indigo-500"
                data-action="click->image-picker#select"
                data-image-picker-id-param="<%= medium.id %>"
                data-image-picker-url-param="<%= medium.thumbnail_url %>"
                data-image-picker-filename-param="<%= medium.filename %>">
          <div class="h-full w-full relative">
            <%= image_tag medium.thumbnail_url, alt: medium.alt_text || medium.filename, class: "h-full w-full object-cover object-center" %>
            <% if medium.video? %>
              <div class="absolute inset-0 flex items-center justify-center">
                <div class="bg-black/50 rounded-full p-2">
                  <svg class="w-6 h-6 text-white" fill="currentColor" viewBox="0 0 24 24">
                    <path d="M8 5v14l11-7z" />
                  </svg>
                </div>
              </div>
            <% end %>
          </div>
        </button>
      <% end %>
    </div>
  <% else %>
    <p class="text-sm text-gray-500 text-center py-8">No <%= @media_type.pluralize %> available. Upload one below.</p>
  <% end %>

  <div class="mt-4 pt-4 border-t border-gray-200">
    <p class="text-sm text-gray-500 mb-2">Or upload a new <%= @media_type %>:</p>
    <form data-action="submit->image-picker#upload" data-image-picker-target="uploadForm">
      <input type="hidden" name="category" value="<%= @category %>" data-image-picker-target="categoryInput">
      <div class="flex gap-2">
        <% accept_type = @media_type == "video" ? "video/*" : "image/*" %>
        <input type="file" name="file" accept="<%= accept_type %>" data-image-picker-target="fileInput" class="flex-1 text-sm text-gray-500 file:mr-2 file:py-1 file:px-2 file:rounded file:border-0 file:text-xs file:font-semibold file:bg-indigo-50 file:text-indigo-700 hover:file:bg-indigo-100">
        <button type="submit" data-image-picker-target="uploadButton" class="inline-flex items-center px-3 py-1 border border-transparent text-sm font-medium rounded-md shadow-sm text-white bg-indigo-600 hover:bg-indigo-700 cursor-pointer">Upload</button>
      </div>
      <p data-image-picker-target="uploadError" class="hidden mt-2 text-sm text-red-600"></p>
      <p data-image-picker-target="uploadProgress" class="hidden mt-2 text-sm text-gray-500">Uploading...</p>
    </form>
  </div>
</div>

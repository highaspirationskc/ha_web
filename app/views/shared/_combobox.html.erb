<%#
  Combobox partial - searchable select dropdown

  Local variables:
    - name: form field name (e.g., "mentee[mentor_id]")
    - label: label text (optional)
    - options: array of [display_text, value] pairs
    - selected_value: currently selected value (optional)
    - selected_text: display text for selected value (optional)
    - placeholder: placeholder text (optional, defaults to "Search...")
    - allow_clear: show clear button (optional, defaults to true)
%>
<% placeholder ||= "Search..." %>
<% allow_clear = true if local_assigns[:allow_clear].nil? %>
<% selected_value ||= nil %>
<% selected_text ||= nil %>
<% label ||= nil %>

<div data-controller="combobox" class="relative">
  <% if label.present? %>
    <%= label_tag name, label, class: "block text-sm font-medium text-gray-700" %>
  <% end %>
  <div class="<%= 'mt-1 ' if label.present? %>relative">
    <input type="text"
           data-combobox-target="input"
           data-action="input->combobox#filter focus->combobox#open keydown->combobox#keydown"
           value="<%= selected_text %>"
           placeholder="<%= placeholder %>"
           autocomplete="off"
           class="block w-full py-2 px-3 border border-gray-300 bg-white rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm">
    <input type="hidden"
           name="<%= name %>"
           value="<%= selected_value %>"
           data-combobox-target="hidden">
    <% if allow_clear %>
      <button type="button"
              data-action="click->combobox#clear"
              class="absolute inset-y-0 right-0 flex items-center pr-3 text-gray-400 hover:text-gray-600">
        <svg class="h-4 w-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
        </svg>
      </button>
    <% end %>
  </div>
  <ul data-combobox-target="list"
      class="hidden absolute z-10 mt-1 w-full bg-white shadow-lg max-h-60 rounded-md py-1 text-base ring-1 ring-black ring-opacity-5 overflow-auto focus:outline-none sm:text-sm">
    <% options.each do |display_text, value| %>
      <li data-combobox-target="option"
          data-value="<%= value %>"
          data-action="click->combobox#select"
          class="cursor-pointer select-none relative py-2 pl-3 pr-9 hover:bg-indigo-50">
        <%= display_text %>
      </li>
    <% end %>
    <% if options.empty? %>
      <li class="py-2 pl-3 pr-9 text-gray-500">No options available</li>
    <% end %>
  </ul>
</div>
